<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Vazirmatn', sans-serif; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø®ØµÙˆØµ Ø¬Ø¯ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            min-width: 1000px;
        }
        
        th {
            white-space: nowrap;
        }
        
        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ -->
    <nav class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <!-- Ù„ÙˆÚ¯Ùˆ Ùˆ Ø¹Ù†ÙˆØ§Ù† -->
                <div class="flex items-center space-x-4">
                    <div class="bg-white/20 p-2 rounded-lg">
                        <span class="text-xl">ğŸ‘¨â€ğŸ’¼</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒØ³ØªÙ…</h1>
                        <p class="text-sm opacity-90">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ {{ user.name }}</p>
                    </div>
                </div>
                
                <!-- Ù…Ù†ÙˆÛŒ Ø³Ù…Øª Ú†Ù¾ -->
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-2 text-sm">
                        <span class="bg-white/20 px-3 py-1 rounded-full">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</span>
                        <span class="opacity-90">{{ user.name }}</span>
                    </div>
                    <a href="/logout" 
                       class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition duration-300 flex items-center">
                        <span class="ml-2">ğŸšª</span>
                        Ø®Ø±ÙˆØ¬
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="container mx-auto px-4 py-6">
        <!-- Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹ -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <div class="text-3xl font-bold text-gray-800">{{ stats.total_users }}</div>
                <div class="text-gray-600">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„</div>
            </div>
            <div class="text-3xl text-blue-500">ğŸ‘¥</div>
        </div>
    </div>
    
    <div class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
            <div>
                <div class="text-3xl font-bold text-gray-800">{{ stats.total_reservations }}</div>
                <div class="text-gray-600">Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡</div>
            </div>
            <div class="text-3xl text-green-500">ğŸ“‹</div>
        </div>
    </div>
    
    <div class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500">
        <div class="flex items-center justify-between">
            <div>
                <div class="text-3xl font-bold text-gray-800">
                    {{ "%.0f"|format(stats.total_company_share / 1000) }}
                </div>
                <div class="text-gray-600">Ø³Ù‡Ù… Ø´Ø±Ú©Øª (Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†)</div>
            </div>
            <div class="text-3xl text-purple-500">ğŸ’°</div>
        </div>
    </div>
    
    <div class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500">
        <div class="flex items-center justify-between">
            <div>
                <div class="text-3xl font-bold text-gray-800">Û±Û¸:Û°Û°</div>
                <div class="text-gray-600">Ù¾Ø§ÛŒØ§Ù† Ù…Ù‡Ù„Øª Ø±Ø²Ø±Ùˆ</div>
            </div>
            <div class="text-3xl text-red-500">â°</div>
        </div>
    </div>
</div>

        <!-- Ù‡Ø´Ø¯Ø§Ø± Ù…Ù‡Ù„Øª Ø±Ø²Ø±Ùˆ -->
        {% if weekly_menu %}
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-yellow-800 mb-2">â° Ù…Ù‡Ù„Øª Ø±Ø²Ø±Ùˆ Ø§ÛŒÙ† Ù‡ÙØªÙ‡</h3>
                    <p class="text-yellow-700">
                        Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØªØ§ 
                        <strong class="text-red-600">{{ weekly_menu.reservation_deadline.split()[0] }} Ø³Ø§Ø¹Øª Û±Û¸:Û°Û°</strong>
                        ÙØ±ØµØª Ø¯Ø§Ø±Ù†Ø¯ ØºØ°Ø§ÛŒ Ù‡ÙØªÙ‡ Ø¢ÛŒÙ†Ø¯Ù‡ Ø±Ø§ Ø±Ø²Ø±Ùˆ Ú©Ù†Ù†Ø¯.
                    </p>
                </div>
                <div class="mt-4 md:mt-0">
                    <div class="bg-red-100 border border-red-300 px-6 py-3 rounded-lg">
                        <div class="text-2xl font-bold text-red-700">
                            {{ weekly_menu.reservation_deadline.split()[0] }} - Û±Û¸:Û°Û°
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ØªØ¨â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8">
                    <button id="tab-users" 
                            class="py-4 px-1 border-b-2 border-blue-500 font-medium text-blue-600">
                        ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                    </button>
                    <button id="tab-menu" 
                            class="py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700">
                        ğŸ½ï¸ Ù…Ù†ÙˆÛŒ Ù‡ÙØªÚ¯ÛŒ
                    </button>
                    <button id="tab-reports" 
                            class="py-4 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700">
                        ğŸ“Š Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ
                    </button>
                </nav>
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§ -->
        
        <!-- ØªØ¨ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
        <div id="content-users" class="fade-in">
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ…</h2>
                        <button onclick="showAddUserModal()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                            <span class="ml-2">â•</span>
                            Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ù†Ø§Ù… Ú©Ø§Ù…Ù„
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø§ÛŒÙ…ÛŒÙ„
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ù†Ù‚Ø´
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    ÙˆØ¶Ø¹ÛŒØª
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø¹Ù…Ù„ÛŒØ§Øª
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for user in users %}
                            <tr class="hover:bg-gray-50 transition">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">{{ user.employee_id }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">{{ user.full_name }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">{{ user.email }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                        {{ user.department or 'ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡' }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if user.is_admin %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">
                                        Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…
                                    </span>
                                    {% else %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if user.is_active %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        ÙØ¹Ø§Ù„
                                    </span>
                                    {% else %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                        ØºÛŒØ±ÙØ¹Ø§Ù„
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="editUser({{ user.id }})" 
                                            class="text-blue-600 hover:text-blue-900 ml-4">
                                        ÙˆÛŒØ±Ø§ÛŒØ´
                                    </button>
                                    <button onclick="resetPassword({{ user.id }}, '{{ user.full_name }}')" 
                                            class="text-yellow-600 hover:text-yellow-900 ml-4">
                                        Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø±Ù…Ø²
                                    </button>
                                    <button onclick="toggleUserStatus({{ user.id }}, {{ user.is_active }})" 
                                            class="text-red-600 hover:text-red-900 ml-4">
                                        {{ 'ØºÛŒØ±ÙØ¹Ø§Ù„' if user.is_active else 'ÙØ¹Ø§Ù„' }}
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ Ù…Ù†ÙˆÛŒ Ù‡ÙØªÚ¯ÛŒ -->
        <div id="content-menu" class="fade-in hidden">
            {% if weekly_menu %}
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">Ù…Ù†ÙˆÛŒ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ</h2>
                            <p class="text-gray-600">
                                Ø§Ø² {{ weekly_menu.week_start }} ØªØ§ {{ weekly_menu.week_end }}
                            </p>
                        </div>
                        <div class="flex space-x-4">
                            <button onclick="showAddFoodModal()" 
                                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                                <span class="ml-2">ğŸ½ï¸</span>
                                Ø§ÙØ²ÙˆØ¯Ù† ØºØ°Ø§
                            </button>
                            <button onclick="generateWeeklyReport()" 
                                    class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center">
                                <span class="ml-2">ğŸ“Š</span>
                                Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø±ÙˆØ²
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ù†Ø§Ù… ØºØ°Ø§
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ù‚ÛŒÙ…Øª Ú©Ø§Ù…Ù„
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø³Ù‡Ù… Ú©Ø§Ø±Ø¨Ø± (Û¶Û°Ùª)
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø³Ù‡Ù… Ø´Ø±Ú©Øª (Û´Û°Ùª)
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø¸Ø±ÙÛŒØª
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    ÙˆØ¶Ø¹ÛŒØª
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ø¹Ù…Ù„ÛŒØ§Øª
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for item in weekly_menu.items %}
                            <tr class="hover:bg-gray-50 transition">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">{{ item.day_of_week }}</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="text-sm font-medium text-gray-900">{{ item.food_name }}</div>
                                    {% if item.description %}
                                    <div class="text-xs text-gray-500 mt-1">{{ item.description }}</div>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        {{ "{:,}".format(item.full_price|int) }} ØªÙˆÙ…Ø§Ù†
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-green-600">
                                        {{ "{:,}".format(item.user_price|int) }} ØªÙˆÙ…Ø§Ù†
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-blue-600">
                                        {{ "{:,}".format(item.company_share|int) }} ØªÙˆÙ…Ø§Ù†
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">{{ item.capacity }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-full bg-gray-200 rounded-full h-2.5 mr-3">
                                            <div class="bg-blue-600 h-2.5 rounded-full" 
                                                 style="width: {{ (item.reserved_count / item.capacity * 100) if item.capacity > 0 else 0 }}%"></div>
                                        </div>
                                        <span class="text-sm font-medium {% if item.reserved_count == item.capacity %}text-red-600{% else %}text-gray-700{% endif %}">
                                            {{ item.reserved_count }}/{{ item.capacity }}
                                        </span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if item.reserved_count == item.capacity %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                        ØªÚ©Ù…ÛŒÙ„
                                    </span>
                                    {% elif item.reserved_count >= item.capacity * 0.8 %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                        Ù¾Ø± Ø´Ø¯Ù†
                                    </span>
                                    {% else %}
                                    <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        Ù…ÙˆØ¬ÙˆØ¯
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="editFood({{ item.id }})" 
                                            class="text-blue-600 hover:text-blue-900 ml-4">
                                        ÙˆÛŒØ±Ø§ÛŒØ´
                                    </button>
                                    <button onclick="updateCapacity({{ item.id }})" 
                                            class="text-green-600 hover:text-green-900 ml-4">
                                        Ø§ÙØ²Ø§ÛŒØ´ Ø¸Ø±ÙÛŒØª
                                    </button>
                                    {% if item.extra_food %}
                                    <span class="px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded mr-2">
                                        ØºØ°Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
                                    </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% else %}
            <div class="bg-white rounded-xl shadow-md p-8 text-center">
                <div class="text-5xl mb-4 text-gray-300">ğŸ½ï¸</div>
                <h3 class="text-xl font-bold text-gray-700 mb-2">Ù…Ù†ÙˆÛŒ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</h3>
                <p class="text-gray-600 mb-6">Ù„Ø·ÙØ§Ù‹ Ù…Ù†ÙˆÛŒ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.</p>
                <button onclick="createWeeklyMenu()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg">
                    Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†ÙˆÛŒ Ù‡ÙØªÙ‡ Ø¬Ø¯ÛŒØ¯
                </button>
            </div>
            {% endif %}
        </div>

        <!-- ØªØ¨ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ -->
        <div id="content-reports" class="fade-in hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ’° Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ Ù‡ÙØªÙ‡</h3>
                    {% if weekly_menu %}
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯:</span>
                            <span class="font-bold text-green-600">
                                {{ "{:,}".format(weekly_menu.items|sum(attribute='full_price') * weekly_menu.items|sum(attribute='reserved_count')) }} ØªÙˆÙ…Ø§Ù†
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Ø³Ù‡Ù… Ø´Ø±Ú©Øª (Û´Û°Ùª):</span>
                            <span class="font-bold text-blue-600">
                                {{ "{:,}".format(weekly_menu.items|sum(attribute='company_share') * weekly_menu.items|sum(attribute='reserved_count')) }} ØªÙˆÙ…Ø§Ù†
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Û¶Û°Ùª):</span>
                            <span class="font-bold text-purple-600">
                                {{ "{:,}".format(weekly_menu.items|sum(attribute='user_price') * weekly_menu.items|sum(attribute='reserved_count')) }} ØªÙˆÙ…Ø§Ù†
                            </span>
                        </div>
                        <div class="pt-4 border-t">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø±Ø²Ø±ÙˆÙ‡Ø§:</span>
                                <span class="font-bold">
                                    {{ weekly_menu.items|sum(attribute='reserved_count') }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-gray-500 text-center py-4">Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
                    {% endif %}
                </div>
                
                <!-- Ú¯Ø²Ø§Ø±Ø´ Ø¢Ù…Ø§Ø±ÛŒ -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“Š Ø¢Ù…Ø§Ø± Ù…Ø´Ø§Ø±Ú©Øª</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-gray-600">Ù…Ø´Ø§Ø±Ú©Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:</span>
                                <span class="font-bold">
                                    {% if users|length > 0 %}
                                        {{ ((weekly_menu.items|sum(attribute='reserved_count') / (users|length * 4)) * 100)|round(1) if weekly_menu else 0 }}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-green-600 h-2.5 rounded-full" 
                                     style="width: {{ ((weekly_menu.items|sum(attribute='reserved_count') / (users|length * 4)) * 100) if weekly_menu and users|length > 0 else 0 }}%"></div>
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t">
                            <h4 class="font-medium text-gray-700 mb-2">Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ† ØºØ°Ø§Ù‡Ø§:</h4>
                            {% if weekly_menu %}
                                {% set popular_foods = weekly_menu.items|sort(attribute='reserved_count', reverse=true)|list %}
                                {% for food in popular_foods[:3] %}
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">{{ food.food_name }}</span>
                                    <span class="text-sm font-bold">{{ food.reserved_count }} Ø±Ø²Ø±Ùˆ</span>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“… Ø±Ø²Ø±Ùˆ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ø±ÙˆØ²</h3>
                    <div class="space-y-3">
                        {% if weekly_menu %}
                            {% set days = ['Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡'] %}
                            {% for day in days %}
                                {% set day_items = weekly_menu.items|selectattr('day_of_week', 'equalto', day)|list %}
                                {% set day_reservations = day_items|sum(attribute='reserved_count') %}
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-gray-600">{{ day }}:</span>
                                        <span class="font-bold">{{ day_reservations }} Ø±Ø²Ø±Ùˆ</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" 
                                             style="width: {{ (day_reservations / (weekly_menu.items|sum(attribute='reserved_count')) * 100) if weekly_menu.items|sum(attribute='reserved_count') > 0 else 0 }}%"></div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-500 text-center py-4">Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="exportToExcel()" 
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center">
                        <span class="ml-2">ğŸ“„</span>
                        Ø®Ø±ÙˆØ¬ÛŒ Excel
                    </button>
                    <button onclick="generatePDF()" 
                            class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg flex items-center">
                        <span class="ml-2">ğŸ“Š</span>
                        Ø®Ø±ÙˆØ¬ÛŒ PDF
                    </button>
                    <button onclick="sendDailyReport()" 
                            class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg flex items-center">
                        <span class="ml-2">ğŸ“§</span>
                        Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„
                    </button>
                    <button onclick="printReport()" 
                            class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg flex items-center">
                        <span class="ml-2">ğŸ–¨ï¸</span>
                        Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± -->
    <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-bold text-gray-800">â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
            </div>
            
            <div class="p-6">
                <form id="addUserForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ *</label>
                            <input type="text" name="employee_id" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Ù†Ø§Ù… Ú©Ø§Ù…Ù„ *</label>
                            <input type="text" name="full_name" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Ø§ÛŒÙ…ÛŒÙ„ *</label>
                            <input type="email" name="email" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± *</label>
                            <input type="password" name="password" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†</label>
                            <select name="department" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="ÙØ±ÙˆØ´">ÙØ±ÙˆØ´</option>
                                <option value="Ù…Ø§Ù„ÛŒ">Ù…Ø§Ù„ÛŒ</option>
                                <option value="Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</option>
                                <option value="ØªÙˆÙ„ÛŒØ¯">ØªÙˆÙ„ÛŒØ¯</option>
                                <option value="IT">IT</option>
                            </select>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" name="is_admin" id="is_admin" 
                                   class="ml-2 h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <label for="is_admin" class="text-gray-700">Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</label>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-4">
                        <button type="button" onclick="hideAddUserModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg">
                            Ø§Ù†ØµØ±Ø§Ù
                        </button>
                        <button type="submit" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg">
                            Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ JavaScript -->
    <script>
        // Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¨â€ŒÙ‡Ø§
        document.getElementById('tab-users').addEventListener('click', () => {
            switchTab('users');
        });
        
        document.getElementById('tab-menu').addEventListener('click', () => {
            switchTab('menu');
        });
        
        document.getElementById('tab-reports').addEventListener('click', () => {
            switchTab('reports');
        });
        
        function switchTab(tabName) {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¨â€ŒÙ‡Ø§
            ['users', 'menu', 'reports'].forEach(tab => {
                const tabBtn = document.getElementById(`tab-${tab}`);
                const content = document.getElementById(`content-${tab}`);
                
                if (tab === tabName) {
                    tabBtn.classList.remove('border-transparent', 'text-gray-500');
                    tabBtn.classList.add('border-blue-500', 'text-blue-600');
                    content.classList.remove('hidden');
                } else {
                    tabBtn.classList.remove('border-blue-500', 'text-blue-600');
                    tabBtn.classList.add('border-transparent', 'text-gray-500');
                    content.classList.add('hidden');
                }
            });
        }
        
        // Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.remove('hidden');
            document.getElementById('addUserModal').classList.add('flex');
        }
        
        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.remove('flex');
            document.getElementById('addUserModal').classList.add('hidden');
        }
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await axios.post('/api/create_user', data);
                
                if (response.data.success) {
                    alert('Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
                    hideAddUserModal();
                    location.reload();
                } else {
                    alert('Ø®Ø·Ø§: ' + response.data.message);
                }
            } catch (error) {
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
            }
        });
        
        // Ø³Ø§ÛŒØ± ØªÙˆØ§Ø¨Ø¹
        function editUser(userId) {
            alert('ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ ID: ' + userId);
            // Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        }
        
        function resetPassword(userId, userName) {
            if (confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ${userName} Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ`)) {
                alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯ (Ø±Ù…Ø² Ø¬Ø¯ÛŒØ¯: User@123!)');
                // Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            }
        }
        
        function toggleUserStatus(userId, isActive) {
            const action = isActive ? 'ØºÛŒØ±ÙØ¹Ø§Ù„' : 'ÙØ¹Ø§Ù„';
            if (confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ${action} Ú©Ù†ÛŒØ¯ØŸ`)) {
                alert(`Ú©Ø§Ø±Ø¨Ø± ${action} Ø´Ø¯`);
                location.reload();
            }
        }
        
        function editFood(foodId) {
            alert('ÙˆÛŒØ±Ø§ÛŒØ´ ØºØ°Ø§ Ø¨Ø§ ID: ' + foodId);
        }
        
        function updateCapacity(foodId) {
            const newCapacity = prompt('Ø¸Ø±ÙÛŒØª Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
            if (newCapacity && !isNaN(newCapacity)) {
                alert('Ø¸Ø±ÙÛŒØª Ø¨Ù‡ ' + newCapacity + ' ØªØºÛŒÛŒØ± ÛŒØ§ÙØª');
                location.reload();
            }
        }
        
        function createWeeklyMenu() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù…Ù†ÙˆÛŒ Ù‡ÙØªÙ‡ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ØŸ')) {
                alert('Ù…Ù†ÙˆÛŒ Ù‡ÙØªÙ‡ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
                location.reload();
            }
        }
        
        function generateWeeklyReport() {
            alert('Ú¯Ø²Ø§Ø±Ø´ Ù‡ÙØªÚ¯ÛŒ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...');
        }
        
        function exportToExcel() {
            alert('Ø®Ø±ÙˆØ¬ÛŒ Excel Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...');
        }
        
        function generatePDF() {
            alert('PDF Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...');
        }
        
        function sendDailyReport() {
            alert('Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }
        
        function printReport() {
            window.print();
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
            switchTab('users');
        });
    </script>
</body>
</html>